 <!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.5 [en] (X11; I; SunOS 5.6 sun4u) [Netscape]">
   <title>RFI guide</title>
</head>
<body text="#000000" background="Images/parchr.gif" LINK = "#660000"  ALINK ="#AA4400" VLINK="#AA044"> 
<A NAME="top"></A>
<table>
<tr>
<td valign="top" WIDTH=120>
<a href="http://online.anu.edu.au/">
<IMG ALIGN=LEFT  SRC="Images/anu.gif" border=0 alt="ANU online"></a> </p>
<p>&nbsp;</p><P>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<a href="http://wwwrses.anu.edu.au/">
<img src="Images/testrses.gif" border=0 alt="RSES Home Page"></A>
<p>
<FONT FACE="Georgia, Verdana, Arial, Helvetica" >
<font color="#660000">

<HR WIDTH=95% SIZE=1 SHADE align=left>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#top">Top </a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#plotrf">Plotting RFs</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#plotp">Plotting profiles</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#convert">Converting NAD files</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#synrf">Synthetic RF's</a>
<p>
 <HR WIDTH=95% SIZE=1 SHADE align=left>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<p>
<HR WIDTH=95% SIZE=1 SHADE align=left>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#top">Top </a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#plotrf">Plotting RFs</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#plotp">Plotting profiles</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#convert">Converting NAD files</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#synrf">Synthetic RF's</a>
<p>
 <HR WIDTH=95% SIZE=1 SHADE align=left>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<p>
<HR WIDTH=95% SIZE=1 SHADE align=left>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#top">Top </a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#plotrf">Plotting RFs</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#plotp">Plotting profiles</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#convert">Converting NAD files</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#synrf">Synthetic RF's</a>
<p>
 <HR WIDTH=95% SIZE=1 SHADE align=left>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<HR WIDTH=95% SIZE=1 SHADE align=left>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#top">Top </a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#plotrf">Plotting RFs</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#plotp">Plotting profiles</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#convert">Converting NAD files</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#synrf">Synthetic RF's</a>
<p>
 <HR WIDTH=95% SIZE=1 SHADE align=left>
<br>&nbsp;<p>&nbsp;</p>
<br>&nbsp;<p>&nbsp;</p>
<p>
<HR WIDTH=95% SIZE=1 SHADE align=left>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#top">Top </a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#plotrf">Plotting RFs</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#plotp">Plotting profiles</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#convert">Converting NAD files</a>
<p>
<IMG SRC="Images/purcube.gif" BORDER=0 ALT="" WIDTH=7 HEIGHT=7>&nbsp;
<A href="#synrf">Synthetic RF's</a>
<p>
 <HR WIDTH=95% SIZE=1 SHADE align=left>
<p>
</font>
</td>

<td valign="top">
&#160;&#160;&#160;&#160;&#160;&#160;

</td>
<td valign="top">

<HTML>


<BODY BGCOLOR="#FFFFFF">
<IMG SRC="Images/colorbar.gif" ALT="-----">
<H1>Receiver function utility programs</H1>
<p>
</b>This page describes the utility programs in the
package <i>NA-sampler</i> which related specifically to the
RFI example. These pages are not intended to be a complete
description of all features of these codes, just a general
guide. Please refer to the input example files, the README
files and the source code for more information.  
<b> Note that</b> you are welcome to change any of these
programs but <b>you do so at your own risk</b>.
</p>
<p>
Several of these codes were originally written by Dr. T. Shibutani,
(RCEP, DPRI, Kyoto Univ., Japan). 
<p>
<IMG SRC="Images/colorbar.gif" ALT="-----">
<p>
As described in the main <i>NA-sampler</i> manual, the RFI 
subroutines use several input and output files. All
of which are in sub-directories of <tt>data/rfi_files</tt>.
The main one is <tt>rfi.in</tt>, which contains parameters
associated with the input data and the names of the other I/O files.
<p>
Two other input files are used. In the default setup these are,
<ul>
<b> rfi_param </b> - in sub-directory <tt>NA_MDL</tt>, which contains
the bounds of the model parameters (Thicknesses, velocities and
Vs/Vp ratio's in each of 6 layers).
<p>
<b> rec_func </b> - in sub-directory <tt>ORF</tt>, which contains
the one or more input (stacked) receiver functions.
<p>
</ul>
Two output files are produced. In the default setup these are,
<ul>
<p>
<b> rec_models </b> - in sub-directory <tt>NA_MDL</tt>, which contains
all models generated at each iteration of the NA in a convenient format.
<p>
<b> rec_func </b> - in sub-directory <tt>NA_SRF</tt>, which contains
the predicted receiver function from the best fit model.
<p>

</ul>
The output files produced by a 500 iteration example is 
included in the <tt>results</tt> directory.
They can be used to demonstrate the use of 
the RFI graphics programs <b>plot_rf</b> and <b>plot_models</b>. 
<p>
<ul>
<li>
<a href="#plotrf"> Plotting Receiver functions </a> </li>

<li>
<a href="#plotp"> Plotting ensembel of velocity profiles</a> </li>

<li>
<a href="#convert">Converting to and from NAD files</a> </li>

<li>
<a href="#synrf"> Calculating synthetic receiver functions</a></li>

<p>
</ul>
</ul>
<A NAME="plotrf"></A>
<IMG SRC="Images/colorbar.gif" ALT="-----">

<p>
<i>Plotting receiver functions</i>
<ul>
<p>
The RFI graphics program <b>plot_rf</b> can be run on the 500 iteration 
example with,
<p><ul><tt>
> cd rfi_files/rfi_plot  <br>

> run_plot_rf-p_demo (or run_plot_rf-x_demo)<br>
</tt>
</ul>
<p>
Each of these is a shell script which supplies some parameters to
the program and produces either X output to the screen,
or postscript output to a file called <tt>plot_rf.ps</tt>.
<p>
Here is an example,
<p>
<IMG SRC="na_sampler_figs/rf.gif" ALT="Observed and best fit 
Receiver functions">
<p> 
The program <b>plot_rf</b> reads the observed receiver function 
in the sub-directory
called <tt>ORF</tt> and the predicted receiver function in the sub-directory
<tt>NA_SRF</tt>. It also reads in a colour palette from file 
<tt>PS_utl/pal.in</tt> and details of the frame annotation from 
<tt>PS_utl/frame.in</tt>. 
<p>
The shell scripts named
<tt>run_plot_rf-x</tt> and <tt> run_plot_rf-x</tt> produce similar
plots for the latest run of <tt>rfi_na</tt>. For more information 
look at the shell scripts and the source code. 
 
<p>
<b> Note that the X-graphics version will crash if netscape 
is running because of a conflict in colour tables.
</b>
</ul>
<p>
<A NAME="plotp"></A>
<p>
<IMG SRC="Images/colorbar.gif" ALT="-----"></p>
<p>
<i>Plotting velocity profiles</i>
<ul>
<p>
The RFI graphics program <b>plot_models</b> can be run on the 
500 iteration example with,
<p><ul><tt>
> cd rfi_files/rfi_plot  <br>
> run_plot_model_demo <br>
</tt>
</ul>
<p>
This is a shell script which supplies some parameters to
the program and produces a postscript file. The name
of the file is specified in the shell script. In the
demo it is called <tt>density_plot.ps</tt>.
<p>
Here is an example,
<p>
<IMG SRC="na_sampler_figs/den.gif" ALT="Ensemble of velocity
 profiles produced by the NA">
<p> 
The program <b>plot_model</b> reads the models from the ascii file
<tt>rfi_models</tt> in the sub-directory <tt>NA_MDL</tt>, and the
parameterization from the file <tt>NA_MDl/rfi_param</tt>. It also
overlays a reference velocity profile read from the file 
<tt>NA_MDL/model_ref</tt> if this file exists. In each case the
directory is fixed but the filename is specified in the shell script. 
<p>
The shell script named <tt>run_plot_modelbw_demo</tt> plots a greyscale
version of the same plot.
<p>
The shell scripts named <tt>run_plot_model</tt> and
<tt>run_plot_modelbw</tt> produce similar
plots for the latest run of <tt>rfi_na</tt>. 
<p> 
In the above figure the red model is the best fit model and the blue
profile is a reference model. The coloured section shows the best
1000 models and the gray section shows the remaining 9000 models.
<p>
For more information look at the shell scripts and the source code. 
 
</ul>
<A NAME="convert"></A>
<p>
<IMG SRC="Images/colorbar.gif" ALT="-----">
<p>
<i>Converting NAD files</i>
<ul>
As stated above the main output file from the RFI sub-routines 
is an ascii file containing the ensemble of models in sub-directory
<tt>rfi_files/NA_MDL</tt>. Some simple programs are provided which
convert between direct access NAD files produced by the na_sampler
routines and this ascii RFI file.
The source of these programs is in <tt>src/nad/nad_convert</tt>
and they serve as examples of reading and writing NAD files. 
(See <a href="nad.html">NAD files</a> for a description of
NAD file format.)

<p>
A NAD file produced by rfi_na can be converted to the ascii RFI file
with,
<p>
<tt>
<ul><ul>
cd data/nad <br>
nad2rfi <i>input_nad_file output_rfi_file </i><br>
</p>
</tt>
</ul></ul>
nd similarly in reverse with,
<p>
<tt>
<ul><ul>
cd data/nad <br>
rfi2nad <i>input_rfi_file output_nad_file </i><br>
</p>
</tt>
</ul></ul>

</ul>
<p>
<A NAME="synrf"></A>
<p>
<IMG SRC="Images/colorbar.gif" ALT="-----">
<p>
<i>Generating synthetic receiver functions</i>
<ul>
<p>
The RFI utility program <b>synrf</b> can be used to generate
a synthetic receiver function from the velocity model
in the file <tt>NA_MDL/model_ref</tt> with,
<p><ul><tt>
> cd rfi_files/rfi_plot  <br>
> run_synrf <br>
</tt>
</ul>
<p>
Again this is a shell script which supplies some parameters to
the program (including filenames). The resulting receiver function
is written as a sac file to the directory <tt>NA_SRF</tt>.
In the example the output file name is <tt>model_ref.syn</tt>. 
It can now be plotted using the program <b>plot_rf</b>.

<p>
In a similar fashion the script <tt>run_synns</tt> can be used to 
run the program <b>synrf_noise</b> to generate
a receiver function with noise added. The noise amplitude is 
input in the script.
</ul>
<p>
<IMG SRC="Images/colorbar.gif" ALT="-----">
<p>
Related sites:

<ul>

<li><a href="na_sampler.html"> <i>NA-sampler</i></a> back to main user guide.</li>

<li><a href="splot.html">splot</a> - general graphics program for display of 
multi-dimensional ensembles. </li>
    
<li><a href="nad.html">NAD</a> - explanation of direct access NAD files. </li>

<li><a href="http://rses.anu.edu.au/~malcolm/NA/na.html">NA homepage</a> </li>

<li><a href="http://rses.anu.edu.au/~malcolm">Malcolm's homepage</a> </li>

</ul>

<IMG SRC="Images/colorbar.gif" ALT="-----">

<br>
Last modified 12th October 1999.

</td>
</tr>
</table>

</body>
</html>

